<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) on Wed Feb 15 00:48:32 GMT 2023 -->
<title>StateMachine (MicroRaft 0.5 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2023-02-15">
<meta name="description" content="declaration: package: io.microraft.statemachine, interface: StateMachine">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/StateMachine.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">io.microraft.statemachine</a></div>
<h1 title="Interface StateMachine" class="title">Interface StateMachine</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public interface </span><span class="element-name type-name-label">StateMachine</span></div>
<div class="block">The abstraction used by <a href="../RaftNode.html" title="interface in io.microraft"><code>RaftNode</code></a> instances to execute operations on
 the user-supplied state machines.
 <p>
 Raft nodes do not deal with the actual logic of committed operations. Once a
 given operation is committed by Raft, i.e., it is replicated to the majority
 of the Raft nodes, the operation is passed to the given state machine
 implementation. It is the state machine implementation's responsibility to
 ensure deterministic execution of the committed operations. In other words, a
 committed operation must produce the same result independent of when or on
 which Raft node instance it is being executed.
 <p>
 The operations committed in a Raft node instance are run in the same thread
 that runs the tasks submitted by that Raft node instance. Since
 <a href="../executor/RaftNodeExecutor.html" title="interface in io.microraft.executor"><code>RaftNodeExecutor</code></a> ensures the thread-safe execution of the tasks
 submitted by a Raft node, state machine implementations do not need to be
 thread-safe.
 <p>
 A <a href="StateMachine.html" title="interface in io.microraft.statemachine"><code>StateMachine</code></a> implementation can implement
 <a href="../lifecycle/RaftNodeLifecycleAware.html" title="interface in io.microraft.lifecycle"><code>RaftNodeLifecycleAware</code></a> to perform initialization and clean up work
 during <a href="../RaftNode.html" title="interface in io.microraft"><code>RaftNode</code></a> startup and termination. <a href="../RaftNode.html" title="interface in io.microraft"><code>RaftNode</code></a> calls
 <a href="../lifecycle/RaftNodeLifecycleAware.html#onRaftNodeStart()"><code>RaftNodeLifecycleAware.onRaftNodeStart()</code></a> before calling any other
 method on <a href="StateMachine.html" title="interface in io.microraft.statemachine"><code>StateMachine</code></a>, and finally calls
 <a href="../lifecycle/RaftNodeLifecycleAware.html#onRaftNodeTerminate()"><code>RaftNodeLifecycleAware.onRaftNodeTerminate()</code></a> on termination.</div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../RaftNode.html" title="interface in io.microraft"><code>RaftNode</code></a></li>
<li><a href="../executor/RaftNodeExecutor.html" title="interface in io.microraft.executor"><code>RaftNodeExecutor</code></a></li>
<li><a href="../lifecycle/RaftNodeLifecycleAware.html" title="interface in io.microraft.lifecycle"><code>RaftNodeLifecycleAware</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#getNewTermOperation()" class="member-name-link">getNewTermOperation</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Returns the operation to be appended after a new leader is elected in a new
 term.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#installSnapshot(long,java.util.List)" class="member-name-link">installSnapshot</a><wbr>(long&nbsp;commitIndex,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&nbsp;snapshotChunks)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Installs the given snapshot chunks for the given commit index, which is same
 with the commit index on which the last snapshot is taken.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#runOperation(long,java.lang.Object)" class="member-name-link">runOperation</a><wbr>(long&nbsp;commitIndex,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;operation)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Executes the given operation on the state machine and returns result of the
 operation.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#takeSnapshot(long,java.util.function.Consumer)" class="member-name-link">takeSnapshot</a><wbr>(long&nbsp;commitIndex,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/Consumer.html" title="class or interface in java.util.function" class="external-link">Consumer</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&nbsp;snapshotChunkConsumer)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Takes a snapshot of the state machine for the given commit index which is the
 current commit index at the local Raft node.</div>
</div>
</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="runOperation(long,java.lang.Object)">
<h3>runOperation</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span>&nbsp;<span class="element-name">runOperation</span><wbr><span class="parameters">(long&nbsp;commitIndex,
 @Nonnull
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;operation)</span></div>
<div class="block">Executes the given operation on the state machine and returns result of the
 operation.
 <p>
 Please note that the given operation must be deterministic and return the
 same result on all Raft nodes of the Raft group.
 <p>
 An operation is executed when it is replicated to the majority of the Raft
 group, hence committed. In addition to that, an operation can be replayed,
 i.e., executed again, if a Raft node crashes and restarts with persisting its
 internal state.
 <p>
 MicroRaft does not inform the state machines if the operation is being
 executed for the first time or replayed, and it is the state machine
 implementations' responsibility to ensure determinism in both cases. For
 instance, if a state machine implementation creates some side effects on
 operation execution, it can also persist the log index of the last executed
 operation so that replays do not cause duplicate side effects. Another option
 would be creating side effects idempotently, so that replays do not make any
 difference.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>commitIndex</code> - the Raft log index on which the given operation is committed</dd>
<dd><code>operation</code> - the user-supplied operation to be executed</dd>
<dt>Returns:</dt>
<dd>the result of the operation execution</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="takeSnapshot(long,java.util.function.Consumer)">
<h3>takeSnapshot</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">takeSnapshot</span><wbr><span class="parameters">(long&nbsp;commitIndex,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/Consumer.html" title="class or interface in java.util.function" class="external-link">Consumer</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&nbsp;snapshotChunkConsumer)</span></div>
<div class="block">Takes a snapshot of the state machine for the given commit index which is the
 current commit index at the local Raft node.
 <p>
 A snapshot must be immutable and must not change when new operations are
 executed on the state machine.
 <p>
 If a state machine implementation maintains a large state, it can divide its
 state into multiple chunks to help the local Raft node send the snapshot to
 the other Raft nodes in the group without overloading the system.
 <p>
 Once a follower falls behind the leader and requires to install a snapshot,
 it may fetch the latest snapshot chunks both from the leader and the other
 followers. Moreover, snapshot chunks can be sent one by one or multiple at
 one go to speed up the snapshot installation process. There is an important
 caveat here. State machine implementations must populate the snapshot chunks
 in a deterministic way, so that a slow follower always reaches to the same
 state with the Raft leader and other followers independent of from which
 nodes the chunks are fetched. If a state machine cannot create multiple
 snapshot chunks in a deterministic way, then it can create a single big
 snapshot chunk to disable optimization, or it can be directly disabled via
 <a href="../RaftConfig.html" title="class in io.microraft"><code>RaftConfig</code></a>. However, disabling this optimization can cause longer
 snapshot transfer durations since the bandwidth of followers is not utilized.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>commitIndex</code> - the commit index on which the current snapshot is being taken</dd>
<dd><code>snapshotChunkConsumer</code> - the consumer object to collect the snapshot chunks</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="installSnapshot(long,java.util.List)">
<h3>installSnapshot</h3>
<div class="member-signature"><span class="return-type">void</span>&nbsp;<span class="element-name">installSnapshot</span><wbr><span class="parameters">(long&nbsp;commitIndex,
 @Nonnull
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&nbsp;snapshotChunks)</span></div>
<div class="block">Installs the given snapshot chunks for the given commit index, which is same
 with the commit index on which the last snapshot is taken. The snapshot
 chunks are in the order they are provided to the chunk consumer parameter of
 <a href="#takeSnapshot(long,java.util.function.Consumer)"><code>takeSnapshot(long, Consumer)</code></a> method.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>commitIndex</code> - the commit index on which the given snapshot is taken</dd>
<dd><code>snapshotChunks</code> - the list of snapshot chunk provided by the state machine when the
            snapshot is taken</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="getNewTermOperation()">
<h3>getNewTermOperation</h3>
<div class="member-signature"><span class="annotations">@Nonnull
</span><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span>&nbsp;<span class="element-name">getNewTermOperation</span>()</div>
<div class="block">Returns the operation to be appended after a new leader is elected in a new
 term.
 <p>
 See <a href="https://groups.google.com/forum/#!msg/raft-dev/t4xj6dJTP6E/d2D9LrWRza8J">
 <i>Bug in single-server membership changes</i></a> post by Diego Ongaro for
 more information.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>the operation to be appended after a new leader is elected in a new
         term.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2023 <a href="https://microraft.io/">MicroRaft</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
